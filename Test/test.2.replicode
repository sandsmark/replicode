; test

!load std.replicode

!class (vec3 x:nb y:nb z:nb)
!class (mk.position (_obj {object: position:vec3}))
!class (mk.last_known (_obj event:))

root:(grp
1; upr
1; spr
0; sln_thr
0; act-thr
0; vis_thr
1; c_sln
0; c_sln_thr
1; c_act
0; c_act_thr
0; dcy_per
0; dcy_tgt
1; dcy_prd
1; sln_chg_thr
1; sln_chg_prd
1; act_chg_thr
1; act_chg_prd
0; avg_sln
0; high_sln
0; low_sln
0; avg_act
0; high_act
0; low_act
1; high_sln_thr
0; low_sln_thr
1; sln_ntf_prd
1; high_act_thr
0; low_act_thr
1; act_ntf_prd
1; high_res_thr
0; low_res_thr
1; res_ntf_prd
root; ntf_grp
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever nil nil 0 0]

self:(ent
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever root nil]

stdin:(grp
1; upr
1; spr
0; sln_thr
0; act-thr
0; vis_thr
1; c_sln
0; c_sln_thr
1; c_act
0; c_act_thr
0; dcy_per
0; dcy_tgt
1; dcy_prd
1; sln_chg_thr
1; sln_chg_prd
1; act_chg_thr
1; act_chg_prd
0; avg_sln
0; high_sln
0; low_sln
0; avg_act
0; high_act
0; low_act
1; high_sln_thr
0; low_sln_thr
1; sln_ntf_prd
1; high_act_thr
0; low_act_thr
1; act_ntf_prd
1; high_res_thr
0; low_res_thr
1; res_ntf_prd
stdin; ntf_grp
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever root nil 0 0]

stdout:(grp
1; upr
1; spr
0; sln_thr
0; act-thr
0; vis_thr
1; c_sln
0; c_sln_thr
1; c_act
0; c_act_thr
0; dcy_per
0; dcy_tgt
1; dcy_prd
1; sln_chg_thr
1; sln_chg_prd
1; act_chg_thr
1; act_chg_prd
0; avg_sln
0; high_sln
0; low_sln
0; avg_act
0; high_act
0; low_act
1; high_sln_thr
0; low_sln_thr
1; sln_ntf_prd
1; high_act_thr
0; low_act_thr
1; act_ntf_prd
1; high_res_thr
0; low_res_thr
1; res_ntf_prd
stdout; ntf_grp
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever root nil 0 0]

P1:(pgm
[]; tpl
   (ptn (mk.position ref_b: ref_pos: [ref_t: ::] ::) |[])
[]; input
   []; inputs
      (ptn m:(mk.position b: pos: [t: ::] ::) []
         (equ b ref_b)
         (gtr t ref_t)
         (neq pos ref_pos)
      )
   |[]; timing
   |[]; guards
[]; prods
   (cmd _inj 0xA1000000 [(mk.last_known m |[] |[] |[] 0) [(_now) 1 400000us nil nil]]); builds L
   (cmd _inj 0xA1000000 [(ins P1 [b pos t]) [(_now) 1 forever stdin nil]]); instantiates P1 with b, pos ..
and t as actual template arguments
   (cmd _set 0xA1000000 [this.vw.res 0]); kills the original
1000000us; tsc
0; csm
0; sig
0; nfr
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

|[]

P2:(pgm
[(ptn ref_b: |[])]; tpl
[]; input
   []; inputs
      (ptn m:(mk.position b: pos: [t: ::] ::) [(neq b ref_b)])
   |[]; timings
   |[]; guards
[]; productions
   (cmd _inj 0xA1000000 [(ins P1 [m]) [(_now) 1 100000us stdin nil]])
   (cmd _inj 0xA1000000 [(ins P2 [b]) [(_now) 1 200000us stdin nil]])
1000000us; tsc
0; csm
0; sig
0; nfr
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

|[]

iP2:(ipgm
P2; code
[]; args
   [nil 1]
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 300000us stdin nil 1]

P3:(pgm
|[]; tpl
[]; input
   []; inputs
      (ptn l:(mk.last_known ::) |[])
   |[]; timing
   |[]; guards
[]; prods
   (cmd _eje 0xA1000000 [l l.vw 0])
1000000us; tsc
0; csm
0; sig
0; nfr
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

|[]

iP3:(ipgm
P3; code
|[]; args
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever stdin nil 1]


P4:(pgm
|[]; tpl
[]; input
   []; inputs
      (ptn m:(mk.position b: (vec3 x: y: z:) [T: s: r: g: o:] ::) |[])
   |[]; timing
   |[]; guards
[]; prods
   (cmd _inj 0xA1000000 [(mk.position b (vec3 (add x 1) y z) |[] |[] |[] 0) [(add T 10000us) s r g o] 0])
1000000us; tsc
0; csm
0; sig
0; nfr
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

|[]

iP4:(ipgm
P4; code
|[]; args
|[]; view
|[]; mks
|[]; vws
0; psln_thr
)

[]
   [(_now) 1 forever stdin nil 1]

O1:(mk.position
self
(vec3 3 3 3)
|[]
|[]
|[]
0
)

[]
   [(_now) 1 500000us stdin nil]

